<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baseball HR/G and BA Line Charts</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/d3-annotation"></script>
</head>
<body>
  <div id="context-section"></div>
  <div id="linechart-container"></div>
  <button id="next-button">Next Chart</button>

  <script>
    
    const svgWidth = window.innerWidth;
    const svgHeight = window.innerHeight;
    const margin = { top: 50, right: 50, bottom: 70, left: 70 };
    const width = svgWidth - margin.left - margin.right;
    const height = svgHeight - margin.top - margin.bottom;
    const dataUrl = "https://raw.githubusercontent.com/UofI-Ryan-Kupiec/UofI-Ryan-Kupiec.github.io/main/Baseball_Hitting_Historic_Data.csv";

    const svg = d3.select("#linechart-container")
      .append("svg")
      .attr("width", svgWidth)
      .attr("height", svgHeight);

    d3.select("#next-button")
      .style("position", "absolute")
      .style("top", "50%")
      .style("right", "20px")
      .style("padding", "12px 20px") 
      .style("font-size", "16px");

    //function drawLineChart1(data) {
      //const filteredData = data.filter(d => d.Year >= new Date(2000, 0, 1) && d.Year <= new Date(2015, 0, 1));
    //}
    
    function drawLineChart1(data, scene_num) {
      if(scene_num == 3){
        const data = data.filter(d => d.Year >= new Date(2014, 0, 1) && d.Year <= new Date(2023, 0, 1));
      }
      
      d3.select("#context-section").html("");
      const contextSection = d3.select("#context-section")

      contextSection.append("h1")
        .style("text-align", "center")
        .style("font-size", "40px")
        .text("Overview");

      contextSection.append("p")
        .style("text-align", "center")  
        .style("font-size", "22px")
        .text("Over the last decade baseball has seen a change unlike any stretch seen in sports history. Statistics has taken over the game and caused major changes to the way the game is played. Not all of these changes in play have been good for the game. As seen in this chart, one major change we have seen in the last few years is a staggering increase in the homerun rate.");

      contextSection.append("p")
        .style("text-align", "center")  
        .style("font-size", "22px")
        .text("Please select the Next Chart button on the right when finished with this page!");
      
      //.style("margin", "0 auto")   // Center the element using auto margins
      
      const svg = d3.select("#linechart-container svg");
      svg.html("");

      const xScale = d3.scaleTime()
        .domain(d3.extent(data, function(d) { return d.Year; }))
        .range([margin.left, width - margin.right]);

      const yScale = d3.scaleLinear()
        .domain(d3.extent(data, function(d) { return d['HR/G']; }))
        .range([height - margin.bottom, margin.top]);

      svg.append("g")
        .attr("transform", `translate(0, ${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).ticks(d3.timeYear.every(10)));

      svg.append("g")
        .attr("transform", `translate(${margin.left}, 0)`)
        .call(d3.axisLeft(yScale));

      const line = d3.line()
        .x(d => xScale(d.Year))
        .y(d => yScale(d['HR/G']));

      svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "blue")
        .attr("stroke-width", 2)
        .attr("d", line);

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height - margin.bottom / 2)
        .attr("text-anchor", "middle")
        .text("Year");

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", margin.left / 2)
        .attr("text-anchor", "middle")
        .text("HR/G (Home Runs per Game)");

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .style("font-size", "1.5em")
        .text("Home Runs per Game over Time");

      if(scene_num == 2){
        d3.select("#context-section").html("");
        const contextSection = d3.select("#context-section")
  
        contextSection.append("h1")
          .style("text-align", "center")
          .style("font-size", "40px")
          .text("Overview");
  
        contextSection.append("p")
          .style("text-align", "center")  
          .style("font-size", "22px")
          .text("This new 'arms race' of data analysis was widely adopted by the league beginning in 2015 all teams began tracking advanded metrics using statcast. This new addition of advanced metrics highlighted what teams should value and as a result caused players to focus on the top metrics that would lead to larger contracts. This drove players to focus less on making contact frequently and more on making hard contact and getting the ball in there. This new prioirty explains this large spike in homeruns per game.");
        
        const highlightStart = new Date(2014, 0, 1);
        const highlightEnd = new Date(2023, 0, 1);
      
        const annotationGroup = svg.append("g") 
          .attr("class", "annotation")
          .style("pointer-events", "none");
      
        const dataPoints = data.filter(d => d.Year >= highlightStart && d.Year <= highlightEnd);
        const yPos = yScale(d3.max(dataPoints, d => d['HR/G']));
  
        annotationGroup.append("rect")
          .attr("x", xScale(highlightStart))
          .attr("y", margin.top) // yPos
          .attr("width", xScale(highlightEnd) - xScale(highlightStart))
          .attr("height", height - margin.bottom - margin.top) // - yPos
          .attr("fill", "yellow")
          .attr("opacity", 0.3);
  
      annotationGroup.append("text")
        .attr("x", (xScale(highlightStart) + xScale(highlightEnd)) / 2)
        .attr("y", xScale(highlightStart)) // Adjust the y position to place the text above the arrow
        .attr("text-anchor", "middle")
        .style("font-size", "16px")
        .text("Years 2014-2023: Explanation for these highlighted years");
      }else if(scene_num == 3){
        d3.select("#context-section").html("");
        const contextSection = d3.select("#context-section")
  
        contextSection.append("h1")
          .style("text-align", "center")
          .style("font-size", "40px")
          .text("Overview3");
  
        contextSection.append("p")
          .style("text-align", "center")  
          .style("font-size", "22px")
          .text("3This new 'arms race' of data analysis was widely adopted by the league beginning in 2015 all teams began tracking advanded metrics using statcast. This new addition of advanced metrics highlighted what teams should value and as a result caused players to focus on the top metrics that would lead to larger contracts. This drove players to focus less on making contact frequently and more on making hard contact and getting the ball in there. This new prioirty explains this large spike in homeruns per game.");
      }
    }

    function drawLineChart2(data) {
      const filteredData = data.filter(d => d.Year >= new Date(2014, 0, 1) && d.Year <= new Date(2023, 0, 1));
      
      d3.select("#context-section").html("");

      const contextSection = d3.select("#context-section")

      contextSection.append("h1").text("Statcast Era");
      contextSection.append("p").text("2Over the last 8 years baseball has seen a change unlike any other sport. Statistics (sabermetrics as they are called in baseball) has taken over the game. It has caused some major changes to the way the game is played and we are going to explore some of those today.");

      const svg = d3.select("#linechart-container svg");
    
      svg.html("");

      const xScale = d3.scaleTime()
        .domain(d3.extent(filteredData, function(d) { return d.Year; }))
        .range([margin.left, width - margin.right]);

      const yScale = d3.scaleLinear()
        .domain(d3.extent(filteredData, function(d) { return d['HR/G']; }))
        .range([height - margin.bottom, margin.top]);

      svg.append("g")
        .attr("transform", `translate(0, ${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).ticks(d3.timeYear.every(1)));

      svg.append("g")
        .attr("transform", `translate(${margin.left}, 0)`)
        .call(d3.axisLeft(yScale));

      const line = d3.line()
        .x(d => xScale(d.Year))
        .y(d => yScale(d['HR/G']));

      svg.append("path")
        .datum(filteredData)
        .attr("fill", "none")
        .attr("stroke", "blue")
        .attr("stroke-width", 2)
        .attr("d", line);

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height - margin.bottom / 2)
        .attr("text-anchor", "middle")
        .text("Year");

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", margin.left / 2)
        .attr("text-anchor", "middle")
        .text("HR/G (Home Runs per Game)");

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .style("font-size", "1.5em")
        .text("Home Runs per Game over Time");
    }
    
    function drawLineChart3(data) {
      d3.select("#context-section").html("");
      
      const contextSection = d3.select("#context-section")

      contextSection.append("h1").text("Home Runs ");
      contextSection.append("p").text("This chart ");

      const svg = d3.select("#linechart-container svg");
      // Clear the contents of the SVG container
      svg.html("");

      // Setup scales and axes for the first chart
      const xScale = d3.scaleTime()
        .domain(d3.extent(data, function(d) { return d.Year; }))
        .range([margin.left, width - margin.right]);

      const yScale = d3.scaleLinear()
        .domain(d3.extent(data, function(d) { return d['HR/G']; }))
        .range([height - margin.bottom, margin.top]);

      svg.append("g")
        .attr("transform", `translate(0, ${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).ticks(d3.timeYear.every(10)));

      svg.append("g")
        .attr("transform", `translate(${margin.left}, 0)`)
        .call(d3.axisLeft(yScale));

      const line = d3.line()
        .x(d => xScale(d.Year))
        .y(d => yScale(d['HR/G']));

      svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "blue")
        .attr("stroke-width", 2)
        .attr("d", line);

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height - margin.bottom / 2)
        .attr("text-anchor", "middle")
        .text("Year");

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", margin.left / 2)
        .attr("text-anchor", "middle")
        .text("HR/G (Home Runs per Game)");

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .style("font-size", "1.5em")
        .text("Home Runs per Game over Time");

      const highlightStart = new Date(2011, 0, 1);
      const highlightEnd = new Date(2020, 0, 1);
    
      const annotationGroup = svg.append("g") 
        .attr("class", "annotation")
        .style("pointer-events", "none");
    
      const dataPoints = data.filter(d => d.Year >= highlightStart && d.Year <= highlightEnd);
      const yPos = yScale(d3.max(dataPoints, d => d['HR/G']));

      annotationGroup.append("rect")
        .attr("x", xScale(highlightStart))
        .attr("y", yPos)
        .attr("width", xScale(highlightEnd) - xScale(highlightStart))
        .attr("height", height - margin.bottom - yPos) // - yPos
        .attr("fill", "yellow")
        .attr("opacity", 0.3);

      annotationGroup.append("text")
        .attr("x", (xScale(highlightStart) + xScale(highlightEnd)) / 2)
        .attr("y", yPos - 20)
        .attr("text-anchor", "middle")
        .style("font-size", "16px")
        .text("Years 2000-2010: Explanation for these highlighted years");
    }
    
    function drawLineChart3(data) {
      const svg = d3.select("#linechart-container svg");
      // Clear the contents of the SVG container
      svg.html("");

      // Setup scales and axes for the second chart
      const xScale = d3.scaleTime()
        .domain(d3.extent(data, function(d) { return d.Year; }))
        .range([margin.left, width - margin.right]);

      const yScale = d3.scaleLinear()
        .domain(d3.extent(data, function(d) { return d['BA']; }))
        .range([height - margin.bottom, margin.top]);

      svg.append("g")
        .attr("transform", `translate(0, ${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).ticks(d3.timeYear.every(5)));

      svg.append("g")
        .attr("transform", `translate(${margin.left}, 0)`)
        .call(d3.axisLeft(yScale));

      const line = d3.line()
        .x(d => xScale(d.Year))
        .y(d => yScale(d['BA']));

      svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "blue")
        .attr("stroke-width", 2)
        .attr("d", line);

      svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", (d) => xScale(d.Year))
        .attr("cy", (d) => yScale(d['BA']))
        .attr("r", 5)
        .attr("fill", "blue")
        .attr("opacity", 0.5);

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height - margin.bottom / 2)
        .attr("text-anchor", "middle")
        .text("Year");

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", margin.left / 2)
        .attr("text-anchor", "middle")
        .text("Batting Average");

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .style("font-size", "1.5em")
        .text("Batting Average over Time");
    }

    // Initialize the scene number to 1 (first chart)
    let currentScene = 1;

    // Attach a click event listener to the "Next" button
    d3.select("#next-button").on("click", function() {
      svg.selectAll(".annotation").remove();
      // Increment the current scene number
      currentScene = (currentScene % 3) + 1;

      // Fetch data from the CSV file and draw the appropriate chart
      d3.csv(dataUrl, function(d) {
        return {
          Year: d3.timeParse('%Y')(d.Year.toString()),
          'HR/G': +d['HR/G'],
          'BA': +d['BA']
        };
      }).then(function(data) {
        if (currentScene === 1 || currentScene === 2 || currentScene === 3) {
          drawLineChart1(data, currentScene); // Draw the first chart
        } else if (currentScene === 4) {
          drawLineChart2(data); // Draw the second chart
        } else if (currentScene === 5) {
          drawLineChart3(data); // Draw the second chart
        }
      });
    });

    // Fetch data from the CSV file and draw the initial chart
    d3.csv(dataUrl, function(d) {
      return {
        Year: d3.timeParse('%Y')(d.Year.toString()),
        'HR/G': +d['HR/G'],
        'BA': +d['BA']
      };
    }).then(function(data) {
      drawLineChart1(data); // Draw the initial chart with the first set of data
    });
  </script>
</body>
</html>
